# ============================================================================
# School Library Application Configuration
# ============================================================================

# Application Settings
spring.application.name=schoollibrary-app
server.port=8080
server.servlet.context-path=/

# ============================================================================
# Database Configuration - PostgreSQL
# ============================================================================
spring.datasource.url=jdbc:postgresql://${DB_HOST:localhost}:${DB_PORT:5432}/${DB_NAME:schoollibrary_db}
spring.datasource.username=${DB_USER:dev_user}
spring.datasource.password=${DB_PASSWORD:dev_password}
spring.datasource.driver-class-name=org.postgresql.Driver

# JPA Configuration
spring.jpa.database-platform=org.hibernate.dialect.PostgreSQLDialect
spring.jpa.hibernate.ddl-auto=validate
spring.jpa.show-sql=false
spring.jpa.properties.hibernate.format_sql=true
spring.jpa.properties.hibernate.use_sql_comments=true

# ============================================================================
# Flyway Database Migration
# ============================================================================
spring.flyway.enabled=true
spring.flyway.baseline-on-migrate=true
spring.flyway.locations=classpath:db/migration
spring.flyway.schemas=public

# ============================================================================
# Security & Authentication - Keycloak OAuth2
# ============================================================================
spring.security.oauth2.resourceserver.jwt.issuer-uri=${KEYCLOAK_URL:http://localhost:8081}/realms/${KEYCLOAK_REALM:schoollibrary}
spring.security.oauth2.resourceserver.jwt.jwk-set-uri=${KEYCLOAK_URL:http://localhost:8081}/realms/${KEYCLOAK_REALM:schoollibrary}/protocol/openid-connect/certs

# Keycloak adapter properties removed; Spring Resource Server validates JWT via issuer/jwks only

# Keycloak Admin Configuration (used by KeycloakIdentityProvider)
keycloak.admin.server-url=${KEYCLOAK_URL:http://localhost:8081}
keycloak.admin.realm=${KEYCLOAK_REALM:schoollibrary}
keycloak.admin.username=${KEYCLOAK_ADMIN:admin}
keycloak.admin.password=${KEYCLOAK_ADMIN_PASSWORD:admin}
keycloak.admin.client-id=admin-cli
keycloak.admin.client-secret=${KEYCLOAK_ADMIN_CLIENT_SECRET:R9anwscL1QYbW2P0JW64IaXv1QGnJZwC}

# Keycloak Token Endpoint Configuration (for Login/Refresh via IdentityProvider)
keycloak.token.client-id=${KEYCLOAK_TOKEN_CLIENT_ID:schoollibrary-app}
keycloak.token.client-secret=${KEYCLOAK_TOKEN_CLIENT_SECRET:zVJEhIf4U8Rrumste1MFcPIfju8nVE7k}

# ============================================================================
# Mail Configuration - Mailpit (Local Development)
# ============================================================================
spring.mail.host=${MAIL_HOST:localhost}
spring.mail.port=${MAIL_PORT:1025}
spring.mail.username=
spring.mail.password=
spring.mail.properties.mail.smtp.auth=false
spring.mail.properties.mail.smtp.starttls.enable=false
spring.mail.properties.mail.smtp.starttls.required=false
spring.mail.properties.mail.smtp.connectiontimeout=5000
spring.mail.properties.mail.smtp.timeout=5000
spring.mail.properties.mail.smtp.writetimeout=5000

# Mail sender configuration
app.mail.from=${MAIL_FROM:noreply@schoollibrary.local}

# ============================================================================
# User Registration Configuration
# ============================================================================
schoollibrary.registration.allowed-domains=${REGISTRATION_ALLOWED_DOMAINS:schule.de,gmail.com}
schoollibrary.registration.email-verification-required=false
schoollibrary.registration.verification-token-expiration-hours=24

# ============================================================================
# Logging Configuration
# ============================================================================
logging.level.root=INFO
logging.level.com.schoollibrary=DEBUG
logging.level.org.springframework.web=DEBUG
logging.level.org.springframework.security=DEBUG
logging.level.org.hibernate.SQL=DEBUG
logging.level.org.hibernate.type.descriptor.sql.BasicBinder=TRACE

# ============================================================================
# Jackson JSON Configuration
# ============================================================================
spring.jackson.serialization.write-dates-as-timestamps=false
spring.jackson.serialization.indent-output=true
spring.jackson.default-property-inclusion=non_null

# ============================================================================
# Actuator Configuration (for monitoring)
# ============================================================================
management.endpoints.web.exposure.include=health,info
management.endpoint.health.show-details=always
management.endpoint.health.probes.enabled=true
management.health.livenessState.enabled=true
management.health.readinessState.enabled=true

# ============================================================================
# Additional Server Settings
# ============================================================================
server.error.include-message=always
server.error.include-binding-errors=always
server.error.include-stacktrace=on_param
server.error.include-exception=false
